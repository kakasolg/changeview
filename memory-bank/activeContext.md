# Active Context - 현재 작업 상황

## 🎯 현재 진행 중인 작업

### 단계: ✅ 문제/답 관리 시스템 구현 완료! - 범용 암기장 핵심 기능 완성 🎉
**목표**: 주제별 문제/답 CRUD 관리 시스템 구축 완료, 사용자가 즉석에서 문제를 추가하고 관리할 수 있는 완전한 시스템

**✅ 완성된 기능들**:
- **동적 라우팅**: `/memorize/[id]/manage` 구현
- **문제 관리 페이지**: 주제별 전용 관리 인터페이스
- **문제/답 추가**: 실시간 폼 검증 및 추가 기능
- **문제 목록**: 추가된 문제들의 완전한 표시
- **네비게이션**: 주제 목록 ↔ 관리 ↔ 학습 연결

**다음 목표**: 학습 모드 구현 (`/memorize/[id]` - 플래시카드 방식)

## � 지혜의 렌즈 - 완전한 학습 플랫폼 완성! 

### ✅ 메인 페이지 전환 완료 (NEW!)
**프로젝트 구조 최적화**:
- ✅ **기존 메인 페이지 백업**: `page.tsx` → `page_old_hexagram_input.tsx`
- ✅ **플래시카드 시스템 메인화**: `/test/flash-card` → `/` (루트 페이지)
- ✅ **이미지 리소스 이동**: `card_front.png`, `card_back.png` → app 폴더
- ✅ **브랜딩 강화**: "🎴 지혜의 렌즈" 타이틀과 사용법 안내 추가

**접근성 극대화**:
- **이전**: `http://localhost:3000/test/flash-card` (서브 페이지)
- **현재**: `http://localhost:3000/` (메인 페이지)
- **효과**: 사용자가 사이트 접속 즉시 핵심 기능 사용 가능

### ✅ 완성된 통합 학습 생태계
**1. 3D 플립 카드 시스템**:
- ✅ 자연스러운 카드 게임 플로우 (뒷면 → 앞면)
- ✅ 앞면: card_back.png + 괘상, 이름, 핵심관점 (문제)
- ✅ 뒷면: card_front.png + 요약, 키워드 (답)
- ✅ 여백 및 폰트 크기 최적화 (16px, 14px)

**2. 학습 진도 추적 시스템**:
- ✅ MongoDB 기반 난이도 추적 (`flash_card_progress` 컬렉션)
- ✅ API 엔드포인트: `/api/flash-card/difficulty`
- ✅ 4단계 난이도: again🐣, soon🐥, later🦉, mastered🧠
- ✅ 사용자별 학습 데이터 기록 및 통계 제공

**3. 개인 메모 시스템 통합**:
- ✅ 기존 user-memo-db 시스템 활용
- ✅ 각 괘별 개인 메모 저장 및 표시
- ✅ 현재 학습 난이도 실시간 표시
- ✅ 메모 입력/수정 인터페이스

**4. 사용자 경험 최적화**:
- ✅ 프로젝트 브랜딩이 포함된 로딩/에러 화면
- ✅ 하단 사용법 안내 (💡 카드 사용법, 📊 학습 시스템 설명)
- ✅ 직관적이고 전문적인 UI/UX

### 🎯 완전한 학습 경험 - 원스톱 플랫폼
**메인 페이지 통합 학습 워크플로우**: 
1. 🌐 사이트 접속 (`http://localhost:3000/`)
2. 🎴 즉시 플래시카드 학습 시작
3. 📖 카드 확인 (괘상, 이름) + 이전 메모 참조
4. 🧠 기억해내기 시도
5. 🔄 카드 뒤집어 답 확인
6. 📝 필요시 개인 메모 작성/수정
7. 📊 난이도 평가 후 자동으로 다음 괘 진행
8. 🔄 무한 반복 학습 가능

**프로덕션 레디 완성도**:
- 💪 즉시 사용 가능한 완전한 기능
- 📚 64괘 전체 데이터 + 개인화 학습 시스템
- 🎯 명확한 사용 목적과 가치 제공
- ✨ 전문적이고 완성도 높은 UI/UX

### 🔄 다음 개발 우선순위
1. **스마트 복습 알고리즘**: 난이도별 출현 빈도 조정
2. **학습 통계 대시보드**: 진도 시각화 및 분석  
3. **8면체 주사위 시스템**: 더 직관적인 괘 선택 방식 (옵션)

## 🎲 새로운 계획: 8면체 주사위 64괘 선택 시스템

### 현재 시스템의 제약 및 개선 이유
**기존 방식**: 사용자 텍스트 입력 → AI가 괘 선택 → 결과 제시
- **문제점**: 점술적 느낌, 사용자 수동성, 주역 원리와 거리감
- **개선 방향**: 사용자가 직접 괘를 선택하는 능동적 참여 방식

### 8면체 주사위 시스템 설계
**수학적 완벽성**: 8 × 8 = 64 (주역 64괘와 정확히 일치)
- **첫 번째 주사위**: 상괘(上卦) - 8가지 기본 상징
- **두 번째 주사위**: 하괘(下卦) - 8가지 기본 상징
- **조합**: 상괘 + 하괘 = 64가지 고유한 괘 조합

### UX 혁신 및 철학적 정합성
- **직관적 인터랙션**: 3D 주사위 애니메이션 + 사용자 클릭으로 정지
- **주역 원리 부합**: 우연의 필연성, 동기감응(동시간 마음의 공명)
- **능동적 참여**: 사용자가 직접 '운명'을 선택하는 주체적 경험

### AI 활용의 진화
**기존**: AI가 괘 선택 → 점술적 느낌
**개선**: 사용자가 괘 선택 → AI가 해석과 적용에 집중 → 더 과학적

### 구현 계획 및 현재 진행상황
**✅ 1단계: 3D 주사위 애니메이션 프로토타입 제작 (95% 완료)**
- ✅ 8면체 주사위 3D 모델링 (Three.js 기반)
- ✅ 파란색(상괘)/빨간색(하괘) 주사위 2개 구현
- ✅ 실시간 회전 애니메이션 구현
- ✅ 사용자 클릭 인터랙션 (굴리기/정지하기)
- ✅ 64괘 계산 로직 완성: (상괘-1) × 8 + 하괘
- ✅ 팔괘 상징 표시 시스템 (☰☱☲☳☴☵☶☷)
- ✅ 테스트 페이지 완성: `/dice-test`
- ⚠️ 팔괘 상징을 주사위 면에 직접 표시 (기술적 이슈로 보류)

**🔄 2단계: 기존 시스템과 통합 (대기 중)**
- MongoDB 64괘 데이터와 연동
- Google Gemini API 해석 엔진 연결
- 찰리 멍거 정신 모델 시스템 통합

**⏳ 3단계: 완성 및 배포**
- 사용자 테스트 및 피드백 반영
- 최종 배포

## 현재 단계: dice-test 주사위 시스템 고도화 완료 ✅
- `dice-test/page.tsx`에 MongoDB API 호출 기능 추가 완료
- 로딩 상태 및 에러 처리 구현 완료
- 실제 괘 데이터 표시 UI 구성 완료
- 주사위 결과와 MongoDB 데이터 연동 완료
- **AI 해석 요청 기능 추가** ✅
  - Google Gemini Function-Calling 방식 적용
  - `/api/ai/function-calling-test` 엔드포인트 활용
  - 찰리 멍거 관점 키워드 해석 구현
- **사용자 메모 시스템 완성** ✅
  - 메모 저장, 조회, 수정, 삭제 (CRUD) 구현
  - `/api/test/user-memo-db` API 연동
  - 페이징, 커스텀 삭제 모달 포함
  - username/password 인증 기반

## 완성된 dice-test 시스템 세부 기능
1. **3D 주사위 애니메이션** - Three.js 기반, 8면체 2개
2. **64괘 계산 로직** - (상괘-1) × 8 + 하괘 = 괘 번호
3. **MongoDB 연동** - 실제 괘 데이터 표시 및 키워드 시스템
4. **AI 해석 시스템** - Gemini Function-Calling으로 찰리 멍거 관점 해석
5. **메모 CRUD 시스템** - 개인화된 기록 및 회고 기능

## 다음 우선순위 작업: 메인 페이지에 주사위 시스템 적용
**목표**: `/dice-test`에서 완성된 전체 시스템을 메인 페이지(`/`)에 통합

**작업 계획**:
1. **메인 페이지 구조 분석**
   - 현재 `src/app/page.tsx` 구조 확인
   - 기존 텍스트 입력 방식과의 통합 방안 검토

2. **주사위 컴포넌트 분리 및 재사용**
   - `dice-test/page.tsx`에서 주사위 관련 로직 컴포넌트화
   - `components/DiceSystem.tsx` 생성
   - Three.js, MongoDB 연동, UI 로직 모듈화

3. **메인 페이지 UI 개선**
   - 텍스트 입력 방식 vs 주사위 방식 선택 옵션 제공
   - 통합된 결과 표시 시스템 구현
   - 반응형 디자인 적용

4. **기능 통합 및 테스트**
   - 두 가지 괘 선택 방식 모두 동일한 결과 화면으로 연결
   - 사용자 경험 최적화
   - 전체 플로우 테스트

**예상 완성 시기**: 다음 세션
**현재 상태**: `/dice-test` 페이지에서 완전히 작동하는 MongoDB 연동 주사위 시스템 완성



## 향후 계획: 팔괘 상징 주사위 면 표시 완성
- 단일 텍스처 UV 매핑 방식
- 3D 텍스트 생성 방식
- 커스텀 8면체 제작 방식


## 완료된 주요 작업
- Next.js 프로젝트 기반 구축
- MongoDB 데이터베이스 시스템
- 64괘 API 시스템
- UI/UX 개선 및 컴포넌트 최적화
- 64괘 데이터 완성
- 정신모델 격자틀 이론 생성 시스템
- Function Calling MongoDB 연동 시스템
- **8면체 주사위 64괘 선택 시스템** (100% 완성) ✅
  - 3D 주사위 애니메이션 및 Three.js 구현
  - 64괘 계산 로직 및 팔괘 시스템
  - **MongoDB 연동 기능** 완성 ✅
  - 실제 괘 데이터 표시 및 로딩/에러 처리
  - **AI 해석 요청 시스템** 완성 ✅
  - **사용자 메모 CRUD 시스템** 완성 ✅
  - `/dice-test` 페이지에서 완전한 통합 시스템 동작 확인
- **플래시 카드 암기장 시스템** (100% 완성) ✅
  - `src/app/test/flash-card/page.tsx` 페이지 구현
  - 카드 뒤집기 애니메이션 (HTML/CSS/JS 기반, Next.js Image 컴포넌트 활용)
  - `/api/hexagrams?random=true` API를 통한 무작위 괘 데이터 연동
  - 카드 앞면: 괘상, 괘 이름, 핵심 관점 표시
  - 카드 뒷면: 요약, 키워드 표시
  - 난이도 평가 버튼 (`again🐣`, `soon🐥`, `later🦉`, `mastered🧠`) 및 다음 괘 불러오기 기능
  - 이미지 파일 `public/test/flash-card/`로 이동 및 경로 수정
  - 관련 TypeScript 오류 해결 및 코드 안정화

## 🎲 새로운 작업: pyproj 점괘 추천 시스템 고도화 (2025-06-13 시작)

### 🎯 현재 상황
**기존 pyproj/app.py**: 단순한 주사위 기반 괘 선택 + AI 해석 (Streamlit)
- ✅ 상괘/하괘 선택 (1~8) → 괘 번호 계산 (1~64)
- ✅ MongoDB + LangChain + Ollama (exaone3.5:7.8b) 연동
- ✅ 스트리밍 AI 응답 시스템

### 🚀 개선 목표: 전통 주역의 동적 연결 메커니즘 구현

#### **1️⃣ 괘쌍 관계 시스템 (철학적 연결성)**
```python
gua_links = {
    6: [9, 23],  # 송(다툼) → 소축(축적), 박(붕괴)
    23: [24],    # 박(허물어짐) → 복(회복)
    24: [25],    # 복(새 시작) → 무망(진실)
    9: [10],     # 소축(준비) → 리(실행)
    # ... 64괘 주제적 연결성 매핑
}
```

#### **2️⃣ 효변(爻變) 메커니즘 (동적 변화)**
```python
eff_change_map = {
    6: {  # 송괘에서 각 효별 지괘(之卦)
        1: 10,  # 초효 변 → 리(履, 실천)
        2: 23,  # 이효 변 → 박(剝, 붕괴)
        3: 26,  # 삼효 변 → 대축(大畜, 큰 저축)
        4: 44,  # 사효 변 → 구(姤, 만남)
        5: 41,  # 오효 변 → 손(損, 덜어냄)
        6: 35,  # 상효 변 → 진(晉, 전진)
    }
}
```

#### **3️⃣ 전통 점사 해석 원칙**
- **변효 0개**: 본괘 괘사로 해석
- **변효 1개**: 해당 효사로 해석
- **변효 2개**: 위쪽 효사로 해석
- **변효 3개**: 본괘+지괘 종합 해석
- **변효 4~6개**: 지괘 중심 해석

### 📋 구현 계획

#### **Phase 1: UI 확장**
- [ ] 효변 선택 UI 추가 (multiselect: 1~6효)
- [ ] 괘상 시각화 (☰☱☲☳☴☵☶☷)
- [ ] 다음 괘 추천 인터페이스

#### **Phase 2: 로직 구현**
- [ ] `gua_links` 완전한 64괘 매핑 데이터
- [ ] `eff_change_map` 전체 괘별 효변 테이블
- [ ] 변효 수별 해석 원칙 적용 함수

#### **Phase 3: AI 프롬프트 고도화**
- [ ] 단순 괘 설명 → 상황별 흐름 분석
- [ ] "현재 X괘에서 Y괘로의 전환 의미" 해석
- [ ] 효변 기반 구체적 행동 가이드

#### **Phase 4: 통합 및 최적화**
- [ ] 메인 프로젝트와 데이터 연동 검토
- [ ] 사용자 히스토리 저장 (MongoDB)
- [ ] 성능 최적화 및 에러 핸들링

### 💡 기대 효과
- **철학적 깊이**: 단순 설명 → 시간적 흐름과 변화 논리
- **사용자 참여**: 수동적 해석 → 능동적 효변 선택
- **교육적 가치**: 괘들 간 연결성 체험 학습
- **확장성**: 향후 복잡한 점사법 (육효점법, 매화역수) 기반 마련

---
